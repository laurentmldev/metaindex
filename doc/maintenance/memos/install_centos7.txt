


Create user
-----------

adduser mxadmin
passwd mxadminname
# gives sudo capabilities
usermod -aG wheel mxadminname

log as mxadminname

mkdir -p mx-maintenance/deliveries


# Sys config for ELK
# ----------------------------------------

# Configure VM mem alloc for ElasticSearch
vi /etc/sysctl.conf
> vm.max_map_count=262144
 
# max opened files
vi /etc/security/limits.conf
> nproc 4096
> <user>  -  nofile  65535

# disable swap
# sudo swapoff -a, or
vi /etc/fstab
> comment lines with swap


# set HEAP size to about 50% of available ram
vi /etc/default/elasticsearch
> ES_HEAP_SIZE=2g
> MAX_LOCKED_MEMORY=unlimited
> MAX_OPEN_FILES=131070
# and then reboot


# update sshd config
# https://wiki.centos.org/HowTos/Network/SecuringSSH#head-3579222198adaf43a3ecbdc438ebce74da40d8ec]section
# ------------------

sudo vi /etc/ssh/sshd_config

>#Port 22
>Port xxxx

>#PermitRootLogin yes
>PermitRootLogin no

>AllowUsers mxadminname
>Protocol 2


>#X11Forwarding no
>X11Forwarding yes

># Banner none
>Banner /etc/sshbanner <-- file to create before with texts contents of the banner


sudo service sshd restart
# /!\ need to update firewall for the ssh being accessible again
# see next session


# update firewall
# ---------------

sudo vi /usr/lib/firewalld/services/ssh.xml
> <port protocol="tcp" port="22"/>
> <port protocol="tcp" port="2233"/>

sudo vi /etc/firewalld/services/phpmyadmin.xml
<?xml version="1.0" encoding="utf-8"?>
<service>
  <short>PHP MyAdmin</short>
  <description>Amdinistration of MySQL database for MetaindeX server</description>
  <port protocol="tcp" port="80"/>
</service>

firewall-cmd --permanent --add-service='phpmyadmin'

firewall-cmd --reload


Docker install 
--------------
curl -fsSL https://get.docker.com/ | sh
sudo usermod -aG docker mxadminname
sudo curl -L "https://github.com/docker/compose/releases/download/1.25.1/docker-compose-$(uname -s)-$(uname -m)" > /usr/bin/docker-compose
sudo chmod 755 /usr/bin/docker-compose


STARTUP
-------
sudo systemctl start docker
sudo docker-compose up





