<beans:beans 	xmlns="http://www.springframework.org/schema/security" 
				xmlns:beans="http://www.springframework.org/schema/beans" 
				xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
				xsi:schemaLocation="http://www.springframework.org/schema/beans
									 http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
									 http://www.springframework.org/schema/security
									 http://www.springframework.org/schema/security/spring-security.xsd">
 
<http>
	<intercept-url pattern="/loginform" access="permitAll" />
	<intercept-url pattern="/loginprocess" access="permitAll" />
	<intercept-url pattern="/logoutprocess" access="permitAll" />
	<intercept-url pattern="/createProfile*" access="permitAll" />
	<intercept-url pattern="/public/*" access="permitAll" />
	<intercept-url pattern="/style/*" access="permitAll" />
	<intercept-url pattern="/media/**" access="permitAll" />
	<intercept-url pattern="/errors/*" access="permitAll" />
	<!-- tmp while making it work (one pb at a time ...) -->
	<intercept-url pattern="/ws/*" access="permitAll" />
	<intercept-url pattern="/myHandler/*" access="permitAll" />
	<intercept-url pattern="/**" access="hasRole('USER')" />
	
	<form-login login-page='/loginform?secure' 
				default-target-url='/profile'
				always-use-default-target='true'
				authentication-failure-url="/loginform?error"
				login-processing-url="/loginprocess" />
	<logout logout-url="/logoutprocess" 
			logout-success-url="/loginform?logout" />
	<access-denied-handler error-page="/public/errors/error403.html" />
	
</http>
  
      <authentication-manager>  
       <authentication-provider>  
       <password-encoder ref="bcryptEncoder"/>		
		<jdbc-user-service 
			data-source-ref="dataSource"
		  	users-by-username-query="select username,password, enabled from users where username=?"
		  	authorities-by-username-query="select users.username, user_roles.role from users, user_roles 
		  			where users.username =? 
		  			and users.user_id = user_roles.user_id" />
       </authentication-provider>  
      </authentication-manager>  
      
  </beans:beans> 
